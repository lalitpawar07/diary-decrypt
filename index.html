<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Unlock Secret Diary</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Mali&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background: linear-gradient(to right,#141e30,#243b55);
  color:white;
  font-family:'Mali', cursive;
}

.container{
  width:90%;
  max-width:700px;
  display:flex;
  flex-direction:column;
}

#reader{
  margin-bottom:10px;
}

textarea{
  height:100px;
  resize:none;
  padding:10px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
}

input,button{
  padding:10px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
}

button{
  background:#ffcc70;
  cursor:pointer;
}

.result{
  margin-top:15px;
  padding:15px;
  background:rgba(0,0,0,0.5);
  border-radius:15px;
  white-space:pre-wrap;
}
</style>
</head>

<body>
<div class="container">

<h2>üîì Decrypt Your Secret</h2>

<button onclick="startScanner()">üì∑ Scan QR</button>
<div id="reader"></div>

<input type="file" accept="image/*" onchange="scanFile(this)">
<textarea id="encryptedText" placeholder="Or paste encrypted text..."></textarea>
<input type="password" id="password" placeholder="Enter Password">

<button onclick="decryptText()">Decrypt</button>

<div class="result" id="result"></div>

</div>

<script>

let html5QrCode;

function startScanner(){
    document.getElementById("reader").innerHTML="";
    html5QrCode = new Html5Qrcode("reader");

    html5QrCode.start(
        { facingMode: "environment" },
        { fps:10, qrbox:250 },
        (decodedText)=>{
            document.getElementById("encryptedText").value = decodedText;
            html5QrCode.stop();
        }
    );
}

function scanFile(input){
    const file = input.files[0];
    if(!file) return;

    const html5QrCode = new Html5Qrcode("reader");

    html5QrCode.scanFile(file, false)
        .then(decodedText => {
            document.getElementById("encryptedText").value = decodedText;
        })
        .catch(err => {
            alert("QR not clear. Try zooming or retaking screenshot.");
        });
}

function decryptText(){

    const encrypted = document.getElementById("encryptedText").value.trim();
    const password = document.getElementById("password").value.trim();

    if(!encrypted || !password){
        alert("Enter encrypted text and password");
        return;
    }

    try{
        const bytes = CryptoJS.AES.decrypt(encrypted, password);
        const decrypted = bytes.toString(CryptoJS.enc.Utf8);

        if(!decrypted) throw "error";

        const data = JSON.parse(decrypted);

        document.getElementById("result").innerHTML =
            data.time + "\n\n" + data.text;

    }catch{
        alert("Wrong Password ‚ùå");
        document.getElementById("result").innerHTML="";
    }
}
</script>

</body>
</html>

