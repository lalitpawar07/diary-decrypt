<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Unlock Notes</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
  background:#111;
  color:white;
  text-align:center;
  font-family:Arial;
}

.container{
  margin:30px auto;
  width:90%;
  max-width:600px;
}

#reader{
  width:100%;
  margin-bottom:20px;
}

textarea{
  width:100%;
  height:120px;
}
</style>
</head>

<body>

<div class="container">
<h2>ðŸ”“ Unlock Your Diary</h2>

<div id="reader"></div>

<textarea id="encryptedText" placeholder="Encrypted text will appear here"></textarea>
<br>
<input type="password" id="password" placeholder="Enter Password">
<br>
<button onclick="decryptText()">Decrypt</button>

<h3 id="output"></h3>

</div>

<script>
function startScanner(){
    const scanner = new Html5Qrcode("reader");

    scanner.start(
        { facingMode:"environment" },
        { fps:10, qrbox:250 },
        (decodedText)=>{
            document.getElementById("encryptedText").value = decodedText;
            scanner.stop();
        }
    );
}
startScanner();

function decryptText(){
    const encrypted = document.getElementById("encryptedText").value;
    const password = document.getElementById("password").value;

    try{
        const bytes = CryptoJS.AES.decrypt(encrypted,password);
        const original = bytes.toString(CryptoJS.enc.Utf8);

        if(!original){
            alert("Wrong Password!");
            document.getElementById("password").value="";
            document.getElementById("output").innerText="";
            return;
        }

        const diaryObject = JSON.parse(original);

        document.getElementById("output").innerText =
            diaryObject.emoji + "\n" +
            diaryObject.time + "\n\n" +
            diaryObject.text;

        // Apply saved font
        if(diaryObject.font){
            document.getElementById("output").style.fontFamily =
                diaryObject.font;
        }

        // Apply saved background
        if(diaryObject.background){
            document.getElementById("editorBox").style.backgroundImage =
                diaryObject.background;
        }

    }catch{
        alert("Error decrypting");
    }
}

</script>

</body>
</html>
