<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Secret Notepad</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Chilanka&family=Edu+QLD+Beginner:wght@400..700&family=Mali:wght@200..700&display=swap" rel="stylesheet">

<!-- CryptoJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<!-- QR Generator -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- Compression Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>

<style>
/* --- SAME DESIGN (shortened for clarity, you can keep yours) --- */
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background: linear-gradient(to right,#141e30,#243b55);
  color:white;
  font-family:'Mali', cursive;
}

.container{
  width:90%;
  max-width:900px;
  height:85vh;
  display:flex;
  flex-direction:column;
}

.editor-box{
  flex:1;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(10px);
  border-radius:20px;
  padding:15px;
  display:flex;
  flex-direction:column;
  background-size:cover;
  background-position:center;
}

textarea{
  flex:1;
  border:none;
  outline:none;
  resize:none;
  font-size:18px;
  padding:15px;
  border-radius:15px;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(4px);
  color:white;
}

button,input,select{
  margin:6px 0;
  padding:8px;
  border-radius:8px;
  border:none;
}

button{
  background:#ffcc70;
  cursor:pointer;
}

#qrcode{
  margin-top:10px;
  padding:10px;
  background:white;
  display:inline-block;
  border-radius:10px;
}
</style>
</head>

<body>

<div class="container">

<h2>‚ú® Your Secret Space</h2>

<div class="editor-box" id="editorBox">
<input type="text" id="emoji" placeholder="Emoji (mood)">
<textarea id="diaryText" placeholder="Write what your heart cannot say aloud..."></textarea>
<input type="password" id="password" placeholder="Set Password">
</div>

<p>Custom Background URL:</p>
<input type="text" id="bgUrlInput" placeholder="https://example.com/image.jpg">
<button onclick="applyCustomBG()">Apply Background</button>

<button onclick="encryptText()">üîê Encrypt & Generate QR</button>

<div id="qrcode"></div>
<button onclick="downloadQR()">‚¨á Download QR</button>

</div>

<script>

let selectedBG = "";

function applyCustomBG(){
    const url = document.getElementById("bgUrlInput").value.trim();
    if(!url){
        alert("Enter background URL");
        return;
    }

    document.getElementById("editorBox").style.backgroundImage = `url('${url}')`;
    selectedBG = url; // store clean URL only
}

function encryptText(){

    const text = document.getElementById("diaryText").value.trim();
    const password = document.getElementById("password").value.trim();
    const emoji = document.getElementById("emoji").value.trim();
    const font = document.getElementById("diaryText").style.fontFamily || "'Mali', cursive";

    if(!text || !password){
        alert("Enter text and password");
        return;
    }

    const diaryObject = {
        emoji: emoji,
        time: new Date().toLocaleString(),
        text: text,
        font: font,

    };

    try{

        // 1Ô∏è‚É£ Convert to JSON
        const jsonData = JSON.stringify(diaryObject);

        // 2Ô∏è‚É£ Compress
        const compressed = pako.deflate(jsonData, { to: 'string' });

        // 3Ô∏è‚É£ Encrypt compressed data
        const encrypted = CryptoJS.AES.encrypt(compressed, password).toString();

        // 4Ô∏è‚É£ Clear old QR
        const qrContainer = document.getElementById("qrcode");
        qrContainer.innerHTML = "";

        // 5Ô∏è‚É£ Generate QR with MEDIUM error correction
        new QRCode(qrContainer, {
            text: encrypted,
            width: 350,
            height: 350,
            correctLevel: QRCode.CorrectLevel.L
        });

    }catch(err){
        alert("QR too large! Try reducing text size.");
        console.error(err);
    }
}

function downloadQR(){

    const canvas = document.querySelector("#qrcode canvas");
    if(!canvas){
        alert("Generate QR first");
        return;
    }

    const image = canvas.toDataURL("image/png");

    // Open in new tab
    const newTab = window.open();
    newTab.document.write(`
        <html>
        <head>
            <title>Save QR</title>
            <style>
                body{
                    margin:0;
                    display:flex;
                    justify-content:center;
                    align-items:center;
                    height:100vh;
                    background:black;
                }
                img{
                    max-width:90%;
                }
                p{
                    position:absolute;
                    top:10px;
                    color:white;
                    font-family:sans-serif;
                }
            </style>
        </head>
        <body>
            <p>Long press image to save to gallery</p>
            <img src="${image}">
        </body>
        </html>
    `);
}

</script>
</body>
</html>

